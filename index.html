<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Payslip</title>

<style>
body{
    margin: 0;
    font-size: 13px;
}

.payslip {
        font-family: 'Times New Roman', Times, serif;
    width: 100%;
    max-width: 900px;       /* para hindi sobrang stretched */
    margin: 0 auto;         /* center horizontally */
    border: 1px solid #000;
    padding: 7px;
    box-sizing: border-box;
}


.center{text-align:center;
    font-size:30px;
}

.center h3{
    margin: 5px 0;
    font-size:30px;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}

th,td{
    border:1px solid #000;
    padding:3.5px;
}

th{
    background:#ddd;
}

input{
    width:98%;
    border:none;
    text-align:right;
    font-size:13px;
}

input:focus{
    outline:none;
    background:#f0f0f0;
}

.bold{
    font-weight:bold;
}

.footer{
    display:flex;
    justify-content:space-between;
    margin-top:20px;
        margin-bottom:10px;
}

.signature{
    width:45%;
    text-align:center;
}

.line{
    border-top:1px solid #000;
    margin-top:40px;
    font-weight:bold;
}


/* --- Default print: Payslip Form (Landscape) --- */
/* --- Print Payslip Full Page (Portrait) --- */
@media print {
    button, .no-print { display: none; }

    /* Inputs formatting */
    input {
        border: none;
        text-align: right;
        background: transparent;
        padding: 0;
    }

    body {
        margin: 0;
        padding: 0;
    }
    
    th, td {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }

    /* Payslip full width but centered */
    .payslip {
        max-width: 1000px;
        margin: 0 ;
        padding: 5mm;
        width: 100%;
        box-sizing: border-box;
        page-break-inside: avoid;
    }

    /* Panels for print */
    .left-panel {
        width: 100%;
        box-shadow: none !important;  /* Remove shadow sa print */
        border: none;                  /* Optional: tanggalin border kung gusto mo cleaner look */
        font-size: 20px; /* Palakihin font para mas readable sa print */

    }

    .right-panel {
        display: none;
    }

    /* Remove shadows sa lahat ng panels just in case */
    .main-layout, .left-panel, .right-panel {
        box-shadow: none !important;
    }

    /* Full page Letter */
    @page {
        size: letter;
        margin: -10px 0px 0 0;
    }
}



/* --- Print Employee Payslip List --- */
@media print {
    th.employee-col,
    td.employee-col {
        width: 10%;        
        max-width: 100%;
        white-space: nowrap; 
        overflow: hidden;    
        text-overflow: ellipsis; 
        font-size: 14px; /* palaki ng font ng employee column */
    }
#payMonth, #cutoff {
    display: none !important;
}
    th.signature-col,
    td.signature-col {
        width: 60%;        
        max-width: 200px;
        white-space: nowrap;
        font-size: 14px; /* palaki ng font ng signature column */
    }

    body.print-list-mode {

        /* Hide other panels */
        .left-panel,
        .payslip {
            display: none !important;
        }

        /* Show right panel */
        .right-panel {
            display: block !important;
            width: 100%;
            border: none !important;
            background: #fff !important;
            box-shadow: none;
            margin: -30px auto 10mm auto;

        }

        /* Hide buttons */
        .right-panel button {
            display: none !important;
        }

        /* Hide Action column */
        #payslipTable th:last-child,
        #payslipTable td:last-child {
            display: none !important;
        }

        /* Table style */
        #payslipTable {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px; /* palaki lahat ng table text */
        }
        

#payslipTable th,
#payslipTable td {
    border: 1px solid #000;
    font-size: 16px;   /* sapat na laki para sa print */
    padding: 6px 8px;  /* mas malinaw spacing */
}
    }

    /* ================= PAGE SIZE MODES ================= */

    body.print-letter {
        @page {
            size: letter portrait;
            margin: 10mm;
        }
    }

    body.print-a4 {
        @page {
            size: A4 portrait;
            margin: 10mm;
        }
    }

    body.print-long {
        @page {
            size: 8.5in 13in;
            margin: 10mm;
        }
    }
}




/* --- Main Layout --- */
.main-layout {
    display: flex;
    flex-direction: row;      /* Desktop: side by side */
    gap: 20px;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; /* Malinis, readable */
    font-size: 14px;
    padding: 15px;
    background-color: #f5f5f5;
}

/* --- Left Panel: Payslip Form --- */
.left-panel {
    flex: 1;
    background: #fff;
    padding: 0px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

/* --- Right Panel: Employee Payslip List --- */
.right-panel {
    flex: 1;
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    max-height: 80vh;
    overflow-y: auto;
}

/* --- Table Styling --- */
.right-panel table {
    width: 100%;
    border-collapse: collapse;
}

.right-panel th, 
.right-panel td {
    border: 1px solid #ddd;
    padding: 6px 8px;
    text-align: left;
}

.right-panel th {
    background-color: #e0e0e0;
    font-weight: 600;
}

.right-panel tbody tr:nth-child(even) {
    background-color: #fafafa;
}

/* --- Buttons --- */
button {
    padding: 6px 12px;
    margin: 2px;
    border: none;
    border-radius: 4px;
    background-color: #0078d7;
    color: white;
    cursor: pointer;
    font-size: 13px;
}

button:hover {
    background-color: #005ea3;
}

button.delete-btn {
    background-color: #d9534f;
}

button.delete-btn:hover {
    background-color: #b52b27;
}

/* --- Responsive Mobile --- */
@media (max-width: 768px) {
    .main-layout {
        flex-direction: column;
    }

    .right-panel {
        max-height: none;
        margin-top: 20px;
    }
}
@media (max-width: 600px) {
    div[style*="flex"] button {
        width: 100%; /* Full width on mobile */
    }
}

</style>
</head>

<body>

<div style="margin-top:10px; text-align:right; display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;">
    <button type="button" onclick="savePayslip()" 
        style="padding:6px 12px; background:#2196F3; color:white; border:none; border-radius:4px; cursor:pointer;">
        üíæ Save
    </button>

    <button type="button" onclick="window.print()" 
        style="padding:6px 12px; background:#4CAF50; color:white; border:none; border-radius:4px; cursor:pointer;">
        üñ® Print
    </button>
</div>

<div class="main-layout">
    <!-- LEFT: Payslip Form -->
    <div class="left-panel">
<div class="payslip">

<div class="center">
    <h3>PAYSLIP</h3>
    MERAKI GARDEN<br>
    REINA MERCEDES, ISABELA
</div>

<br>

<div style="display:flex; justify-content:space-between; align-items:center; gap:20px; margin-bottom:10px;">
    
<!-- Pay Date Selector -->
<div style="display:flex; align-items:center; gap:10px;">
    <label style="white-space:nowrap;">Pay Date:</label>

    <!-- Month selector -->
    <select id="payMonth" onchange="updatePayDate()">
        <option value="January">January</option>
        <option value="February">February</option>
        <option value="March">March</option>
        <option value="April">April</option>
        <option value="May">May</option>
        <option value="June">June</option>
        <option value="July">July</option>
        <option value="August">August</option>
        <option value="September">September</option>
        <option value="October">October</option>
        <option value="November">November</option>
        <option value="December">December</option>
    </select>

    <!-- Cutoff selector -->
    <select id="cutoff" onchange="updatePayDate()">
        <option value="15">1-15</option>
        <option value="EOM">16-End</option>
    </select>

    <input type="text" id="payDate" readonly style="width:150px; text-align:center; font-size:20px; font-family:'Times New Roman', Times, serif;">
</div>

<!-- Employee -->
<div style="position:relative; display:flex; align-items:center; gap:10px;">
    <label style="white-space:nowrap;">Employee:</label>

    <input 
        type="text" 
        id="employee" 
        name="employee"
        placeholder="Type employee name"
        autocomplete="off"
        style="width:100%; font-size: 20px; font-family: 'Times New Roman', Times, serif;"
    >

    <!-- Suggestions -->
    <div id="suggestions"
         style="
            position:absolute;
            top:100%;
            left:80px;
            right:0;
            background:#fff;
            border:1px solid #ccc;
            max-height:160px;
            overflow-y:auto;
            display:none;
            z-index:9999;
            box-shadow:0 2px 6px rgba(0,0,0,0.15);
         ">
    </div>
</div>
</div>


<table border="1" cellpadding="5" cellspacing="0" style="width:100%; table-layout: fixed;">
<tr>
    <th>EARNINGS</th>
    <th>AMOUNT</th>
</tr>
<tr>
    <td>Rate / Day</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" id="rate" oninput="compute()"></td>
</tr>
<tr>
    <td>Total Days</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" id="days" oninput="compute()"></td>
</tr>
<tr>
    <td>Rate / Hour</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" id="rateHour" readonly></td>
</tr>
<tr>
    <td>Total Hours (OT)</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" id="totalHours" oninput="compute()"></td>
</tr>
<tr>
    <td>Basic Pay</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" id="basic" readonly></td>
</tr>
<tr class="bold">
    <td>Total Earnings</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" id="totalEarnings" readonly></td>
</tr>
</table>

<table border="1" cellpadding="5" cellspacing="0" style="width:100%; table-layout: fixed;">
<tr>
    <th>DEDUCTIONS</th>
    <th>AMOUNT</th>
</tr>
<tr>
    <td>STALLS</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" class="deduct" data-key="stalls" oninput="compute(this)"></td>
</tr>
<tr>
    <td>CHARGES</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" class="deduct" data-key="charges" oninput="compute(this)"></td>
</tr>
<tr>
    <td>CASH ADVANCE</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" class="deduct" data-key="cashAdvance" oninput="compute(this)"></td>
</tr>
<tr>
    <td>SSS</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" class="deduct" data-key="sss" oninput="compute(this)"></td>
</tr>
<tr>
    <td>PHILHEALTH</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" class="deduct" data-key="philhealth" oninput="compute(this)"></td>
</tr>
<tr>
    <td>PAG-IBIG</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" class="deduct" data-key="pagibig" oninput="compute(this)"></td>
</tr>
<tr>
    <td>OTHER</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" class="deduct" data-key="other" oninput="compute(this)"></td>
</tr>
<tr class="bold">
    <td>Total Deductions</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" id="totalDeduct" readonly></td>
</tr>
<tr class="bold">
    <td>Net Pay</td>
    <td><input style="font-size: 20px; font-family: 'Times New Roman', Times, serif;" id="netPay" readonly></td>
</tr>
</table>

<br>
<!-- Net Pay Footer Display -->
<div style="margin-top:20px; text-align:center;">
    <div id="netPayNumber" style="font-size:30px; font-weight:bold; margin: 20px;">0</div>
    <div id="netPayWords" style="font-size:18px; font-style:italic; font-weight: bold;">Zero</div>
</div>

<br>
<!-- Signature Section -->
<div class="footer">

    <div class="signature">
        <div class="line">ELIZABETH COLOMA</div>
        SECRETARY
    </div>

    <div class="signature">
        <div class="line" id="signatureEmployee">EMPLOYEE</div>
        EMPLOYEE
    </div>

</div>
    </div>
</div>



<!-- RIGHT: Payslip List -->
<div class="right-panel">

    <h3>
        Employee Payslip List 
        <span id="listPayDate" style="font-size:14px; font-weight:normal; margin-left:10px;"></span>
    </h3>

<!-- Print and Clear Buttons -->
<div style="margin-bottom:10px; display:flex; gap:10px; flex-wrap:wrap;">
    <button type="button" onclick="printPayslipList()" 
        style="padding:6px 12px; background:#4CAF50; color:white; border:none; border-radius:4px; cursor:pointer;">
        üñ®Ô∏è Print List
    </button>

    <button type="button" onclick="clearPayslipList()" 
        style="padding:6px 12px; background:#f44336; color:white; border:none; border-radius:4px; cursor:pointer;">
        üóëÔ∏è Clear List
    </button>
</div>

    <table border="1" width="100%" id="payslipTable">
        <thead>
            <tr>
                <th>#</th>
                <th class="employee-col">Employee</th>
                <th class="signature-col">Signature</th>
                <th>Net Pay</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <!-- Auto insert dito -->
        </tbody>
    </table>

</div>
</div>


<script>
// ================= EMPLOYEE DATA =================
const employeeList = [
    { name: "ALVAREZ, BRYAN", rate: 480 },
    { name: "GAFFUD, FRANCISCO", rate: 600 },
    { name: "GAMBALAN, MARK LEO", rate: 550 },
    { name: "IGNACIO, ANGELITO", rate: 480 },
    { name: "MARQUEZ, DENVER", rate: 550 },
    { name: "SALVADOR, MARK ANTHONY", rate: 550 },
    { name: "DELA CRUZ, ROEL", rate: 480 },
    { name: "GUERRERO, RIZAL", rate: 480 },
    { name: "MARQUEZ, JAN GERO", rate: 550 },
    { name: "CASAGUEP, GABIEL", rate: 480 },
    { name: "BALABAT, ARIEL", rate: 1000 },
    { name: "DELA CRUZ, ROMEL", rate: 480 },
    { name: "LANGUIDO, LEYMAR", rate: 480 },
    { name: "CAGURANGAN, RODOLFO", rate: 480 },
    { name: "ALVAREZ, JENCELLE", rate: 480 },
    { name: "COLOMA, ELIZABETH", rate: 600 },
    { name: "ELDUCAL, CRISTINE", rate: 480 },
    { name: "GABITAN, MARGIELYN", rate: 550 },
    { name: "MARTIN, ANGELICA", rate: 480 },
    { name: "AGREGADO, MARILYN", rate: 600 },
    { name: "DALAUDIAO, ESTELITA", rate: 480 },
    { name: "LIBARI, MARIBEL", rate: 480 },
    { name: "OAO, MA. FE", rate: 480 },
    { name: "RIVERA, MARIVIC", rate: 500 },
    { name: "TALAL, EVELYN", rate: 480 },
    { name: "VALDEZ, LOVELYN", rate: 480 },
    { name: "GAFFUD, JOANNE", rate: 450 },
    { name: "REGGIE", rate: 1000 },
    { name: "FREDDIE", rate: 580 },
    { name: "MARVIN", rate: 480 },
    { name: "CHRISTIAN", rate: 480 },
    { name: "LAGAZO, ERMIE", rate: 500 },
    { name: "NALDOZA, JEANALYN", rate: 500 },
    { name: "RODICH, JENNY", rate: 480 },
    { name: "AQUINO, DIMPLE", rate: 1000 },
    { name: "BACCAY, KENNETH", rate: 500 },
    { name: "TALON, MARK LAURENCE", rate: 500 }
];


// ================= AUTOCOMPLETE =================
const empInput = document.getElementById("employee");
const rateInput = document.getElementById("rate");
const suggestionBox = document.getElementById("suggestions");

empInput.addEventListener("input", function(){

    const keyword = this.value.toLowerCase().trim();
    suggestionBox.innerHTML = "";

    if(!keyword){
        suggestionBox.style.display = "none";
        return;
    }

    const matches = employeeList.filter(e =>
        e.name.toLowerCase().includes(keyword)
    );

    if(matches.length === 0){
        suggestionBox.style.display = "none";
        return;
    }

    matches.forEach(emp => {

        const div = document.createElement("div");

        div.textContent = emp.name + " - ‚Ç±" + emp.rate;

        div.style.padding = "6px 10px";
        div.style.cursor = "pointer";

        div.onmouseover = () => div.style.background = "#f0f0f0";
        div.onmouseout  = () => div.style.background = "#fff";

        div.onclick = () => {

            empInput.value = emp.name;
            rateInput.value = emp.rate;

            suggestionBox.style.display = "none";

            if(typeof compute === "function"){
                compute();
            }
        };

        suggestionBox.appendChild(div);
    });

    suggestionBox.style.display = "block";
});

// Hide kapag click sa labas
document.addEventListener("click", function(e){

    if(!empInput.contains(e.target) && !suggestionBox.contains(e.target)){
        suggestionBox.style.display = "none";
    }

});

// Save all inputs to localStorage
function saveData(){
    document.querySelectorAll("input").forEach(input=>{
        localStorage.setItem(input.id || input.name, input.value);
    });
}

// Load saved data
function loadData(){
    document.querySelectorAll("input").forEach(input=>{
        let saved = localStorage.getItem(input.id || input.name);
        if(saved !== null){
            input.value = saved;
        }
    });

    compute();       // recompute earnings/deductions
    updatePayDate(); // set Pay Date after load
}

// Main compute function
function compute() {
    // --- Inputs ---
    let rateInput = document.getElementById("rate");
    let daysInput = document.getElementById("days");
    let totalHoursInput = document.getElementById("totalHours");

    let rate = Number(rateInput.value) || 0;
    let days = Number(daysInput.value) || 0;

    // Allow hours with H/h
    let rawHours = totalHoursInput.value || "0";
    let hours = parseFloat(rawHours.replace(/[^0-9.]/g, "")) || 0;

    // --- Calculations ---
    let rateHour = rate / 8;
    document.getElementById("rateHour").value = rateHour.toFixed(2);

    let basic = rate * days;
    document.getElementById("basic").value = basic.toLocaleString();

    let overtime = rateHour * hours;
    let totalEarnings = basic + overtime;
    document.getElementById("totalEarnings").value = totalEarnings.toLocaleString();

    // --- Deductions ---
    let totalDeduct = 0;
    document.querySelectorAll(".deduct").forEach(d => {
        let val = Number(d.value) || 0;
        totalDeduct += val;

        // Save each deduction in localStorage
        if (d.dataset.key) {
            localStorage.setItem("deduct_" + d.dataset.key, d.value);
        }
    });
    document.getElementById("totalDeduct").value = totalDeduct.toLocaleString();

    // --- Net Pay ---
    let net = totalEarnings - totalDeduct;
    document.getElementById("netPay").value = net.toLocaleString();

    // --- Footer Display ---
    const netPayNumberDiv = document.getElementById("netPayNumber");
    const netPayWordsDiv = document.getElementById("netPayWords");

    if (netPayNumberDiv && netPayWordsDiv) {
        netPayNumberDiv.innerText = net.toLocaleString();

        let integerPart = Math.floor(net);
        let decimalPart = Math.round((net - integerPart) * 100);

        let words = numberToWords(integerPart);
        if (decimalPart > 0) words += " and " + numberToWords(decimalPart) + " Centavos";

        netPayWordsDiv.innerText = words;
    }

    // --- Autosave all main inputs ---
    localStorage.setItem("rate", rateInput.value);
    localStorage.setItem("days", daysInput.value);
    localStorage.setItem("totalHours", totalHoursInput.value);
    localStorage.setItem("totalEarnings", totalEarnings.toLocaleString());
    localStorage.setItem("totalDeduct", totalDeduct.toLocaleString());
    localStorage.setItem("netPay", net.toLocaleString());
}

// --- Load saved data on page load ---
window.addEventListener("load", () => {
    // Load main inputs
    if (localStorage.getItem("rate")) document.getElementById("rate").value = localStorage.getItem("rate");
    if (localStorage.getItem("days")) document.getElementById("days").value = localStorage.getItem("days");
    if (localStorage.getItem("totalHours")) document.getElementById("totalHours").value = localStorage.getItem("totalHours");

    // Load deductions
    document.querySelectorAll(".deduct").forEach(d => {
        if (d.dataset.key) {
            const saved = localStorage.getItem("deduct_" + d.dataset.key);
            if (saved !== null) d.value = saved;
        }
    });

    // Recalculate totals & net pay
    compute();
});

// -----------------------------
// Number to Words Function
// -----------------------------
function numberToWords(n){
    const ones = ["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"];
    const teens = ["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"];
    const tens = ["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];
    const thousand = ["","Thousand","Million","Billion"];

    if(n === 0) return "Zero";

    let word = "";
    let i = 0;

    while(n > 0){
        let chunk = n % 1000;
        if(chunk){
            word = chunkToWords(chunk) + " " + thousand[i] + " " + word;
        }
        n = Math.floor(n / 1000);
        i++;
    }

    return word.trim();
}

function chunkToWords(n){
    const ones = ["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"];
    const teens = ["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"];
    const tens = ["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];
    let str = "";

    if(n >= 100){
        str += ones[Math.floor(n/100)] + " Hundred ";
        n = n % 100;
    }
    if(n >= 20){
        str += tens[Math.floor(n/10)] + " ";
        n = n % 10;
    } else if(n >= 10){
        str += teens[n-10] + " ";
        n = 0;
    }
    if(n > 0){
        str += ones[n] + " ";
    }
    return str.trim();
}


// Update Pay Date based on cutoff selection
function updatePayDate() {
    const cutoff = document.getElementById("cutoff").value;
    const month = document.getElementById("payMonth").value;
    const payInput = document.getElementById("payDate");

    const year = new Date().getFullYear();
    const monthIndex = new Date(`${month} 1, ${year}`).getMonth();
    const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();

    // Update payDate field
    if(cutoff === "15"){
        payInput.value = `${month} 1-15`;
    } else {
        payInput.value = `${month} 16-${daysInMonth}`;
    }

    // Save selections in localStorage
    localStorage.setItem("payMonth", month);
    localStorage.setItem("cutoff", cutoff);
    localStorage.setItem("payDate", payInput.value);
}

// --- Load saved month + cutoff on page load ---
window.addEventListener("load", () => {
    const savedMonth = localStorage.getItem("payMonth");
    const savedCutoff = localStorage.getItem("cutoff");

    if(savedMonth){
        document.getElementById("payMonth").value = savedMonth;
    }

    if(savedCutoff){
        document.getElementById("cutoff").value = savedCutoff;
    }

    // Recalculate payDate based on saved values
    updatePayDate();
});

// --- Auto save all inputs on change ---
document.querySelectorAll("input").forEach(input=>{
    input.addEventListener("input", saveData);
});

// --- Auto update Pay Date when cutoff changes ---
document.getElementById("cutoff").addEventListener("change", updatePayDate);


// --- Realtime Sync Employee to Signature (LAST, FIRST ‚Üí FIRST LAST) ---
// --- DOM Elements ---
const employeeInput = document.getElementById("employee");
const signatureDiv = document.getElementById("signatureEmployee");

// --- Update Signature Function ---
function updateSignature() {
    const val = employeeInput.value.trim();

    if (val === "") {
        signatureDiv.textContent = "EMPLOYEE";
        localStorage.removeItem("employee");
        return;
    }

    // LAST, FIRST ‚Üí FIRST LAST
    if (val.includes(",")) {
        const parts = val.split(",");
        const last = parts[0].trim();
        const first = parts[1].trim();
        signatureDiv.textContent = (first + " " + last).toUpperCase();
    } else {
        signatureDiv.textContent = val.toUpperCase();
    }

    // Save to localStorage
    localStorage.setItem("employee", val);
}

// --- Listen for typing & autocomplete ---
employeeInput.addEventListener("input", () => setTimeout(updateSignature, 10));
employeeInput.addEventListener("change", updateSignature);
employeeInput.addEventListener("blur", updateSignature);

// --- Unified Load Function ---
function loadEmployee() {
    const saved = localStorage.getItem("employee");
    if (saved) {
        employeeInput.value = saved;
        updateSignature(); // ensures signature shows FIRST LAST
    }
}

// --- Page Load Handler ---
window.addEventListener("load", () => {
    // Load employee + signature
    loadEmployee();

    // Load other functions if they exist
    if (typeof loadData === "function") loadData();
    if (typeof updatePayDate === "function") updatePayDate();
    if (typeof loadPayslipList === "function") loadPayslipList();
});


let payslips = JSON.parse(localStorage.getItem("payslips")) || [];

// Load list pag open
window.addEventListener("load", loadPayslipList);

function savePayslip(){

    const employee = document.getElementById("employee").value;
    const payDate  = document.getElementById("payDate").value;
    const netPay   = document.getElementById("netPay").value;

    if(!employee){
        alert("Please enter employee name");
        return;
    }

    const data = {
        id: Date.now(),
        employee,
        payDate,
        netPay
    };

    payslips.push(data);

    localStorage.setItem("payslips", JSON.stringify(payslips));

    loadPayslipList();

    alert("Payslip Saved!");
}

// Load list
function loadPayslipList() {
    const tbody = document.querySelector("#payslipTable tbody");
    tbody.innerHTML = "";

    const currentPayDate = document.getElementById("payDate").value;
    document.getElementById("listPayDate").innerText = `Pay Date: ${currentPayDate}`;

    // Sort payslips alphabetically by employee name (A-Z)
    const sortedPayslips = [...payslips].sort((a, b) => {
        const nameA = a.employee.toUpperCase(); // ignore case
        const nameB = b.employee.toUpperCase();
        if(nameA < nameB) return -1;
        if(nameA > nameB) return 1;
        return 0;
    });

    sortedPayslips.forEach((p, i) => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${i+1}</td>
            <td class="employee-col">${p.employee}</td>
            <td class="signature-col" style="text-align:right;"></td>
            <td style="text-align:right;">${p.netPay}</td>
            <td>
                <button onclick="loadPayslip(${p.id})">Edit</button>
                <button onclick="deletePayslip(${p.id})" style="color:red;">Delete</button>
            </td>
        `;

        tbody.appendChild(tr);
    });
}

// Load to form
function loadPayslip(id) {
    const p = payslips.find(x => x.id === id);
    if (!p) return;

    document.getElementById("employee").value = p.employee;
    document.getElementById("payDate").value  = p.payDate;
    document.getElementById("netPay").value   = p.netPay;

    alert("Loaded for editing");
}

// --- Delete payslip ---
function deletePayslip(id) {
    if (!confirm("Delete this payslip?")) return;

    payslips = payslips.filter(p => p.id !== id);
    localStorage.setItem("payslips", JSON.stringify(payslips));
    loadPayslipList();
}
// --- Print Employee Payslip List with Size Option ---
function printPayslipList(size = "letter") {

    // Remove old size classes
    document.body.classList.remove("print-a4","print-letter","print-long");

    // Add print mode
    document.body.classList.add("print-list-mode");

    // Add size mode
    if(size === "a4"){
        document.body.classList.add("print-a4");
    }
    else if(size === "long"){
        document.body.classList.add("print-long");
    }
    else{
        document.body.classList.add("print-letter"); // default
    }

    // Print
    window.print();

    // Cleanup after print
    setTimeout(() => {
        document.body.classList.remove(
            "print-list-mode",
            "print-a4",
            "print-letter",
            "print-long"
        );
    }, 1000);
}

//JS Function to Clear Payslip List
function clearPayslipList() {
    if (!payslips.length) {
        alert("The payslip list is already empty!");
        return;
    }

    const confirmClear = confirm("Are you sure you want to delete all payslips from the list? This action cannot be undone.");
    if (!confirmClear) return;

    payslips = []; // clear array
    localStorage.setItem("payslips", JSON.stringify(payslips)); // update storage
    loadPayslipList(); // refresh table

    alert("All payslips have been cleared!");
}


// --- Existing Save Payslip Function ---
function savePayslip() {
    const employee = document.getElementById("employee").value;
    const payDate  = document.getElementById("payDate").value;
    const netPay   = document.getElementById("netPay").value;

    if (!employee) {
        alert("Please enter employee name");
        return;
    }

    const data = {
        id: Date.now(),
        employee,
        payDate,
        netPay
    };

    payslips.push(data);
    localStorage.setItem("payslips", JSON.stringify(payslips));

    loadPayslipList();
    alert("Payslip Saved!");
}

let payslipEntries = []; // global array para sa lahat ng payslips


//2Ô∏è‚É£ Render Function
function renderPayslipList(){
    const tbody = document.querySelector("#payslipTable tbody");
    tbody.innerHTML = "";

    payslipEntries.forEach((entry, index) => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${index+1}</td>
            <td class="employee-col">${entry.employee}</td>
            <td >${entry.netPay.toLocaleString()}</td>
            <td>
                <button onclick="editPayslip(${entry.id})">Edit</button>
                <button onclick="deletePayslip(${entry.id})">Delete</button>
            </td>
        `;

        tbody.appendChild(tr);
    });
}
//3Ô∏è‚É£ Edit at Delete
function editPayslip(id){
    const entry = payslipEntries.find(e => e.id === id);
    if(!entry) return;

    // Fill form
    document.getElementById("employee").value = entry.employee;
    document.getElementById("payDate").value = entry.payDate;
    document.getElementById("rate").value = entry.rate;
    document.getElementById("days").value = entry.days;
    document.getElementById("totalHours").value = entry.totalHours;

    const deducts = document.querySelectorAll(".deduct");
    deducts[0].value = entry.stalls;
    deducts[1].value = entry.charges;
    deducts[2].value = entry.cashAdvance;
    deducts[3].value = entry.sss;
    deducts[4].value = entry.philhealth;
    deducts[5].value = entry.pagibig;

    // Recompute totals
    compute();

    window.scrollTo({ top: 0, behavior: 'smooth' });
}


</script>



</body>
</html>
